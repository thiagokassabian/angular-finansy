<div *ngIf="(spinnerService.isLoading | async) === false">
	<app-breadcrumb
		[items]="[{ text: 'Lançamentos', link: '/entries' }, { text: pageTitle }]"
	></app-breadcrumb>

	<page-header
		page-name="Formulário"
		[page-title]="pageTitle"
		button-class="btn-primary"
		button-link="/entries"
		button-text="Voltar"
	></page-header>

	<div class="card">
		<div class="card-header">Informações sobre o lançamento</div>
		<div class="card-body">
			<form [formGroup]="resourceForm" (submit)="submitForm()">
				<div class="form-row">
					<div class="form-group col-md-2">
						<label for="type">Tipo</label>
						<select
							name="type"
							id="type"
							class="form-control"
							formControlName="type"
						>
							<option *ngFor="let option of typeOptions" [ngValue]="option.key">
								{{ option.value }}
							</option>
						</select>

						<div class="text-danger" *ngIf="resourceForm.get('type').touched">
							<div *ngIf="resourceForm.get('type').errors?.required">
								Obrigatório
							</div>
						</div>
					</div>
					<div class="form-group col-md-6">
						<label for="name">Lançamento</label>
						<input
							type="text"
							class="form-control"
							id="name"
							formControlName="name"
							required
						/>
						<div class="text-danger" *ngIf="resourceForm.get('name').touched">
							<div *ngIf="resourceForm.get('name').errors?.required">
								Obrigatório
							</div>
							<div *ngIf="resourceForm.get('name').errors?.minlength">
								Mínimo 3 caracteres
							</div>
						</div>
					</div>
					<div class="form-group col-md-2">
						<label for="amount">Valor</label>
						<div class="input-group">
							<div class="input-group-prepend">
								<span class="input-group-text" id="valor-reais">R$</span>
							</div>
							<input
								[imask]="imaskConfig"
								type="text"
								class="form-control text-right"
								id="amount"
								formControlName="amount"
								aria-label="Valor"
								aria-describedby="valor-reais"
								required
							/>
						</div>

						<div class="text-danger" *ngIf="resourceForm.get('amount').touched">
							<div *ngIf="resourceForm.get('amount').errors?.required">
								Obrigatório
							</div>
						</div>
					</div>
					<div class="form-group col-md-2">
						<label for="date">Data</label>
						<p-calendar
							id="date"
							styleClass="w-100"
							inputStyleClass="form-control"
							formControlName="date"
							dataType="string"
							dateFormat="dd/mm/yy"
							[showButtonBar]="true"
							[monthNavigator]="true"
						></p-calendar>
						<div class="text-danger" *ngIf="resourceForm.get('date').touched">
							<div *ngIf="resourceForm.get('date').errors?.required">
								Obrigatório
							</div>
						</div>
					</div>
				</div>
				<div class="form-row">
					<div class="form-group col-md-6">
						<label for="description">Descrição</label>
						<input
							type="text"
							class="form-control"
							id="description"
							formControlName="description"
						/>
					</div>
					<div class="form-group col-md-3 d-flex align-items-end">
						<!-- <label for="pago">Pago?</label> -->
						<div
							class="btn-group w-100"
							role="group"
							aria-label="Lançamento pago?"
						>
							<button
								type="button"
								class="btn btn-outline-secondary"
								(click)="resourceForm.get('paid').setValue(true)"
								[class.active]="resourceForm.get('paid').value === true"
							>
								Pago
							</button>
							<button
								type="button"
								class="btn btn-outline-secondary"
								(click)="resourceForm.get('paid').setValue(false)"
								[class.active]="resourceForm.get('paid').value === false"
							>
								Pendente
							</button>
						</div>
						<div class="text-danger" *ngIf="resourceForm.get('paid').touched">
							<div *ngIf="resourceForm.get('paid').errors?.required">
								Obrigatório
							</div>
						</div>
					</div>
					<div class="form-group col-md-3">
						<label for="categoryId">Categoria</label>
						<select
							name="categoryId"
							id="categoryId"
							class="form-control"
							formControlName="categoryId"
						>
							<option *ngFor="let category of categories" [value]="category.id">
								{{ category.name }}
							</option>
						</select>

						<div
							class="text-danger"
							*ngIf="resourceForm.get('categoryId').touched"
						>
							<div *ngIf="resourceForm.get('categoryId').errors?.required">
								Obrigatório
							</div>
						</div>
					</div>
				</div>
				<div class="text-right">
					<button
						[disabled]="submittingForm || resourceForm.invalid"
						type="submit"
						class="btn btn-primary"
					>
						Salvar
					</button>
				</div>
				<div class="alert alert-danger" *ngIf="serverErrorMessages">
					<p>Erro do servidor</p>
					<ul>
						<li *ngFor="let error of serverErrorMessages">{{ error }}</li>
					</ul>
				</div>
			</form>
		</div>
	</div>
</div>
